<div class="min-h-screen bg-zinc-50">
  <header class="sticky top-0 z-10 border-b border-black/10 bg-white/80 backdrop-blur">
    <div class="mx-auto max-w-4xl px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button type="button" class="btn-ghost" (click)="goBack()">â†</button>

        <div>
          <h1 class="text-base font-semibold text-black">{{ title() }}</h1>
          <p class="text-xs text-black/50">
            Share code: <span class="font-mono">{{ shareCode() }}</span>
          </p>
        </div>
      </div>

      <button type="button" class="btn" (click)="randomPick()" [disabled]="busy()">
        ğŸ² Random
      </button>
    </div>
  </header>

  <main class="mx-auto max-w-4xl px-6 py-8 space-y-6">
    <!-- Add -->
    <section class="card p-6">
      <h2 class="text-lg font-semibold">Agregar peli</h2>

      <div class="mt-4 grid gap-3 sm:grid-cols-[1fr_140px_140px]">
        <!-- Title + Suggestions -->
        <div class="relative">
          <input
            class="input"
            [ngModel]="newTitle"
            (ngModelChange)="onTitleInput($event)"
            placeholder="EscribÃ­ y te sugieroâ€¦"
            (focus)="showSuggestions.set(suggestions().length > 0)"
            autocomplete="off"
          />

          <div
            *ngIf="showSuggestions()"
            class="absolute z-20 mt-2 w-full rounded-2xl border border-black/10 bg-white shadow-sm overflow-hidden"
          >
            <button
              type="button"
              *ngFor="let s of suggestions()"
              class="w-full text-left px-4 py-3 hover:bg-black/5 transition flex items-center justify-between gap-3"
              (mousedown)="pickSuggestion(s)"
            >
              <span class="font-medium truncate">{{ s.title }}</span>
              <span class="text-xs text-black/50">
                {{ s.release_date ? (s.release_date | slice:0:4) : '' }}
              </span>
            </button>
          </div>
        </div>

        <input class="input" [(ngModel)]="newYear" type="number" placeholder="1994" />

        <button type="button" class="btn" (click)="add()" [disabled]="busy() || !newTitle.trim()">
          Agregar
        </button>
      </div>

      <p class="hint mt-3">
        Consejo: metÃ© 10 pelis antes de tirar el random, si no el algoritmo se deprime.
      </p>
    </section>

    <!-- List -->
    <section class="card p-6">
      <div class="flex items-center justify-between gap-4">
        <h2 class="text-lg font-semibold">PelÃ­culas</h2>

        <div class="text-sm text-black/60">
          Pendientes: <span class="font-semibold">{{ pendingCount() }}</span>
          <span class="mx-1">Â·</span>
          Vistas: <span class="font-semibold">{{ watchedCount() }}</span>
        </div>
      </div>

      <div class="mt-4 space-y-3" *ngIf="movies().length; else empty">
        <div
          *ngFor="let m of movies()"
          class="rounded-2xl border border-black/10 bg-white p-4 flex items-start justify-between gap-4"
        >
          <div class="min-w-0">
            <div class="flex items-center gap-2">
              <div
                class="font-semibold truncate"
                [ngClass]="{
                  'line-through': m.watched,
                  'text-black/40': m.watched
                }"
              >
                {{ m.title }}
              </div>

              <span *ngIf="m.year" class="text-xs text-black/50">({{ m.year }})</span>
            </div>

            <div class="mt-1 text-xs text-black/40">
              {{ m.watched ? 'Vista âœ…' : 'Pendiente â³' }}
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button type="button" class="btn-ghost" (click)="toggle(m)" [disabled]="busy()">
              {{ m.watched ? 'Desmarcar' : 'Marcar vista' }}
            </button>

            <button type="button" class="btn-ghost" (click)="remove(m)" [disabled]="busy()">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>

      <ng-template #empty>
        <div class="mt-4 rounded-xl border border-black/10 bg-white p-4 text-sm text-black/60">
          No hay pelis todavÃ­a. AgregÃ¡ un par y tirÃ¡ el ğŸ².
        </div>
      </ng-template>
    </section>

    <div *ngIf="errorMsg()" class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800">
      {{ errorMsg() }}
    </div>
  </main>

  <!-- Modal Random -->
  <div *ngIf="picked()" class="fixed inset-0 z-50 grid place-items-center bg-black/40 p-6">
    <div class="card w-full max-w-md p-6">
      <div class="text-xs text-black/50">Tu destino esâ€¦</div>

      <div class="mt-2 text-2xl font-semibold">
        {{ picked()!.title }}
      </div>

      <div *ngIf="picked()!.year" class="mt-1 text-sm text-black/60">
        ({{ picked()!.year }})
      </div>

      <div class="mt-6 flex gap-2">
        <button type="button" class="btn w-full" (click)="markPickedWatched()" [disabled]="busy()">
          Marcar como vista
        </button>

        <button type="button" class="btn-ghost w-full" (click)="picked.set(null)">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>